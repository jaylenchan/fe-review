![img](../pic/Web开发流程图.png)
## 总览

本文档作为所有开发文档的大体轮廓，包括广研项目开发的开发模式，开发思想等。因此，希望大家能够在阅读其他项目的开发文档之前，首先仔细阅读一遍这个文档的相关内容，不断巩固广研的项目开发模式与相关流程。


以上是我个人绘制的关于广研所有业务项目几乎都会经过的开发流程图。在开发业务内容的时候，你应该将自己定位成开发者的身份从右上角【个人电脑】出发；而在调试业务内容或者追踪bug的时候，你应该转换成用户的身份从正下方各种浏览器、webview、小程序的方向出发。

## 开发流程

### 一个登录功能的开发历程

- 假设你在开发一个用户登录的功能，你拿着产品的PRD，设计的UI看懂之后，你开始在你的电脑VSCode开发相关内容【右上角“个人电脑”】。
- 在开发前端内容的时候，你很快能够想到利用webpack在本地提供一个devServer辅助你的开发【中部“开发环境”】，让dev-server为你提供你开发好的静态资源，实时看到开发效果。
- 当你经过了精心的设计和代码调整之后，你的登录模块终于开发完成了，此时你应该会想要将你的代码部署到测试服务器上去，然后进行产品走查和内容测试。这个时候，你可以自己每次都手动将本地的代码打包完成后，通过远程复制传输到测试服务器上去。但更多的，我们借助了CI系统Jenkins，让Jenkins帮助我们去做这些手动的事情。
- 于是你不再需要自己手动部署代码到测试服务器，现在你只需要将你的代码提交到gitlab。gitlab中会有指定的webhook跟Jenkins接应。其实这个gitlab webhook就是一个http请求而已，通知Jenkins说你可以来拉取我的代码了。而Jenkins服务器接收到对应的请求，就会开始拉取gitlab的代码（当然，中间还需要一些凭据，相关内容我会后续补充）。
- 当Jenkins将gitlab中对应的代码仓库对应的分支代码拉取下来之后，就会开始使用相关的构建工具进行打包（其实这一步如果不是Jenkins做，你在本地就需要每次进行打包，是不是感觉很麻烦？）。
- 经过了漫长的两分钟等待，Jenkins使用构建工具将我们的源代码打包完成之后，就成功获得了相关的dist文件夹，这里头放的东西就是前端需要部署的东西。【当然，如果你想要看看dist里头到底有什么东东，有两种方式：方式1是你直接在Jenkins的控制台查看相关内容，方式2时你在自己本地电脑把项目build一下，看看最终生成的dist文件夹里头有什么。两种方式各有用处，方式1的好处就是你可以看到都有哪些文件被打包而不需要具体内容， 方式2的好处就是可以看到具体dist里头的文件是啥，文件的具体内容有什么。】
- 可喜可贺，dist拿到了，接下来Jenkins会使用sshPublisher插件帮你连接对应的线下服务器，然后将dist传输到线下服务器，这样你就完成一次线下服务器的部署，赶快去看看自己的开发成果吧！
- 当然，你可能会疑惑，为啥我知道要部署到哪里去，还能知道具体的部署磁盘路径？其实我记忆力也没那么好，但是Jenkins给我们提供了一份Jenkinsfile配置（每个前端项目都有一份， Jenkinsfile语法其实就是一种DSL），通过Jenkinsfile我们就可以知道Jenkins会做些什么事情，最后会部署到哪里去（具体地，我会开相应篇章叙述）。
- 好啦，现在的你已经成功的将代码部署到线下服务器了，赶紧去浏览器刷新看看吧！

## 调试流程

### 一个登录功能的调试流程

- 经过了你的精心设计，代码已经部署到了线下服务器。现在全公司的相关人员都能看到你的开发成果，产品进行走查，测试进行测试。过了两三天，产品走查结束了，你到自己的bugTags查看，看到了产品提的一连串bug。于是你又要进入你的项目，开始改自己的代码bug，虽然你也曾经跟我一样觉得自己就是天赋异禀的代码bug free之子。
- 问题来了，如何通过一个bug重新映射到我们的项目开发环境去呢？问题抛出，一开始信息满满，你撸起袖子准备大显身手，打开项目，输入`yarn serve`或者`yarn dev`，项目开发环境跑起来了，控制台显示`localhost:8080`，webpack-dev-server还贴心地帮你把浏览器自动打开了，结果你望着浏览器地址栏中的`localhost:8080`信心十足地等待页面结果，当你看到页面白页的时候，你傻眼了，明明没错啊，这是为什么？
- 实际上，这是因为广研的项目大部分是一些混合项目。比如一个Hybrid H5页，实际上最终是需要一个登录token才能真正开启你的项目页面的，但是你通过指定ip的形式，你脱离了登录token，只是一个`ip:port`的无用地址，当然就打不开界面了。为了解决类似的问题，广研的前端统一引入了一个叫做Whistle服务器的东西，通过Whistle我们就可以解决上述的问题。
- 你需要在自己的电脑中安装whistle服务器。然后经过whistle的代理配置，类似于`www.esmatch.cn localhost:8080`的规则，你就可以将`www.esmatch.cn/page/mapi/index?token=xxx`替换成`localhost:8080/page/mapi/index?token=xxx`。通过以上操作你就可以将你的bug重新映射回你的开发环境。
- 接下来，开始改你的bug吧！
